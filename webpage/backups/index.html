<!DOCTYPE html>
    <html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Database App</title>

        <!-- Custom page stlyings -->
        <link href="./stylings.css" rel="stylesheet">

        <!-- Javascript -->
        <!-- 
            <script src="./menu.js" type="text/javascript"></script>
        --> 

        <!-- jQuery and jQuery-UI -->
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


        <!-- Bootstrap CSS CDN -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

        <!-- Font Awesome JS -->
        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>

        <!-- jQuery CDN - Slim version (=without AJAX) -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <!-- Popper.JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
        <!-- Bootstrap JS -->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

    </head>

    <body>

        <!-- <h1>Lets make some sidebarsssss</h1> -->

        <!-- Div that contains the web page -->
        <div class="wrapper">

            <!--
                Sidebar is a nav element
                The sidebar can contain a header div called sidebar-header
                The sidebar must contain an unordered that can be nested.
                When nesting this list, specific items can have the below:
                    -> Collapsable via the data-toggle attribute.
                    -> Class for dropdown-toggle.
                    -> Items here have class "collapse type".
                    -> The nest can the content of a link.
            
            -->
            <nav id="sidebar">
                <div class="sidebar-header">
                    <h3>HR Database App</h3>
                </div>
        
                <ul class="list-unstyled components">
                    <p>Choose Query By Section</p>
                    <li class="active">
                        <a href="#section1_menu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Section 1 Queries</a>
                        <ul class="collapse list-unstyled" id="section1_menu">
                            <li>
                                <a id="Section1_Query1" href="#">Query 1</a>
                            </li>
                            <li>
                                <a id="Section1_Query2" href="#">Query 2</a>
                            </li>
                            <li>
                                <a id="Section1_Query3" href="#">Query 3</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#section2_menu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Section 2 Queries</a>
                        <ul class="collapse list-unstyled" id="section2_menu">
                            <li>
                                <a id="Section2_Query1" href="#">Query 1</a>
                            </li>
                            <li>
                                <a id="Section2_Query2" href="#">Query 2</a>
                            </li>
                            <li>
                                <a id="Section2_Query3" href="#">Query 3</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#section3_menu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Section 3 Queries</a>
                        <ul class="collapse list-unstyled" id="section3_menu">
                            <li>
                                <a id="Section3_Query1" href="#">Query 1</a>
                            </li>
                            <li>
                                <a id="Section3_Query2" href="#">Query 2</a>
                            </li>
                            <li>
                                <a id="Section3_Query3" href="#">Query 3</a>
                            </li>
                        </ul>
                    </li>
                </ul>

                <!-- Run 'em All Button-->
                <button type="button" id="runAllQueries" class="btn btn-info">
                    <span>Run All Queries</span>
                </button>

            </nav>

            <!-- Navbar containing toggle button and page links -->
            <div id="content">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <div class="container-fluid">
            
                        <!-- Toggle button -->
                        <button type="button" id="sidebarCollapse" class="btn btn-info">
                            <i class="fas fa-align-left"></i>
                            <span>Toggle Sidebar</span>
                        </button>


                        <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <i class="fas fa-align-justify"></i>
                            <span>View Pages</span>
                        </button>

                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="nav navbar-nav ml-auto">
                                <li class="nav-item active">
                                    <a class="nav-link" href="#">Section 1</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Section 2</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Section 3</a>
                                </li>
                            </ul>
                        </div>
            
                    </div>
                </nav>

                <!-- Modal content if it was ignored -->
                <!-- 
                        <div id="helperDiv">
                        <br><br>
                        <h5 class="modal-title">Welcome to the online HR Database App</h5>
                        <p>Use the sidebar on the left to navigate to a specific query, or the navigation buttons on the top right.
                     <br>From there you can navigate the queries for that section using the sidebar, or move to another section using the navigation buttons.</p>
                    </div>
                 -->

                <!-- TV Div Template -->
                <br><br>
                <div class="tv" id="tvDiv" style="position: relative; height: 575px; width: 1200px; border: 3px solid black; margin: auto;" >

                    <!-- Navigate channels -->
                    <div class="tv tv-nav" id="tv-left" style="position: absolute; width: 70px; height: 545px; border: 2px solid green; left: 10px; top: 15px; bottom: 15px;"></div>
                    <div class="tv tv-nav" id="tv-right" style="position: absolute; width: 70px; height: 545px; border: 2px solid blue; right: 10px; top: 15px; bottom: 15px;"></div>

                    <!-- Screen -->
                    <div
                        class="tv-content"
                        style="position: absolute; width: auto; height: 470px; border: 2px solid red; left: 85px; right: 85px; top: 15px; bottom: 15px;"
                    >

                        <div
                            class="tv tv-screen"
                            style="position: absolute; width:auto; height: auto; border: 2px solid blue; left: 5px; right: 5px; top: 5px; bottom: 5px;"
                        >

                            <!-- Header / Query Label -->
                            <h5 class="modal-title">Welcome to the online HR Database App</h5>

                            <!-- Query Code Block -->
                            <p>Use the sidebar on the left to navigate to a specific query, or the navigation buttons on the top right.</p>

                            <!-- Results -->
                            <p>From there you can navigate the queries for that section using the sidebar, or move to another section using the navigation buttons.</p>

                            <!-- Simple Table -->
                            <table class="table table-dark" style="position: absolute; bottom: 5px; ">

                                <!-- Header -->
                                <thead>
                                  <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">emp_id</th>
                                    <th scope="col">First Name</th>
                                    <th scope="col">Last Name</th>
                                    <th scope="col">Date of Birth</th>
                                  </tr>
                                </thead>

                                <!-- Body -->
                                <tbody>
                                    <tr>
                                      <th scope="row">1</th>
                                      <td>1147</td>
                                      <td>John</td>
                                      <td>Doe</td>
                                      <td>06/06/1987</td>
                                    </tr>
                                    <tr>
                                      <th scope="row">2</th>
                                      <td>329</td>
                                      <td>Jane</td>
                                      <td>Doe</td>
                                      <td>23/10/1980</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>4589</td>
                                        <td>Bill</td>
                                        <td>Joe</td>
                                        <td>18/04/1990</td>
                                      </tr>
                                  </tbody>
                                </table>

                        </div>
                    </div>

                    <!-- TV Buttons -->
                    <div class="tv tv-btn" style="padding-top: 10px; position: absolute; bottom: 10px; border: 2px solid purple; left: 90px; right: 90px; width: auto; height: 65px;">

                        <!-- Go to first -->
                        <button type="button" id="goToFirst" class="btn btn-info" style="position: absolute; left: 2%;">
                            <span>Go to First</span>
                        </button>

                        <!-- Run Query -->
                        <button type="button" id="runQuery" class="btn btn-info" style="position: absolute; left: 35%;">
                            <span>Run Query</span>
                        </button>

                        <!-- Reset -->
                        <button type="button" id="resetBtn" class="btn btn-info"style="position: absolute; right: 35%;">
                            <span>Reset</span>
                        </button>

                        <!-- Go to last -->
                        <button type="button" id="goToLast" class="btn btn-info" style="position: absolute; right: 2%;">
                            <span>Go to Last</span>
                        </button>

                    </div>

                </div>

            </div>
        
        </div>

        <!-- Modal for how to navigate webpage -->
        <div id="tutorialModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Welcome to the online HR Database App</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Use the sidebar on the left to navigate to a specific query, or the navigation buttons on the top right.</p>
                        <p>From there you can navigate the queries for that section using the sidebar, or move to another section using the navigation buttons.</p>
                    </div>
                </div>
            </div>
        </div>

        <!--
            Does not work unless unless specified here FFS = Bootstrap

            Script for sidebar
        
        -->
        <script type="text/javascript">

            // Initalize required variables
            let xhttp, updated;
            let db, query, results, counter, out;
            let cmsEntry;
            let sectionID = 0;
            let queryID = 0;
            let menuID = `s${sectionID}q${queryID}`;

            // Setup data object
            cms = new Map([
                ["Section1", new Map()],
                ["Section2", new Map()],
                ["Section3", new Map()],
            ]);

            $(document).ready(function () {

                // Display helper modal on page load (index.html only)
                $("#tutorialModal").modal('show');

                // Toggle the sidebar
                $('#sidebarCollapse').on('click', function () {
                    $('#sidebar').toggleClass('active');
                });

                // Populate the menu
                xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {

                    if (this.readyState == 4 && this.status == 200) {

                        // Populate each section
                        for(cmsEntry of this.responseText.split('\n') ) {
                            
                            // Setup section data
                            sectionID = cmsEntry.split("|")[0];
                            queryID = cmsEntry.split('|')[1];
                            queryLabel = cmsEntry.split('|')[2];
                            query = cmsEntry.split('|')[3];

                            // Handle updating in memory CMS
                            console.log("Updated " + sectionID);
                            cms.get(sectionID).set(queryID, new Map());
                            cms.get(sectionID).get(queryID).set("QueryLabel", queryLabel);
                            cms.get(sectionID).get(queryID).set("Query", query);
                            }
                        
                        // Update the side bar
                        for(section of cms.keys()){
                            console.log("Printing the data for " + section + ":");
                            for(sectionQuery of cms.get(section).keys()) {
                                menuID=`${section}_${sectionQuery}`;
                                $(`#${menuID}`).text( cms.get(section).get(sectionQuery).get("QueryLabel") );
                            }
                        }
                        
                    } else {
                        console.log(`\nError updating articleDiv with AJAX call state = ${this.readyState}, status = ${this.status}`);
                        console.log(`Response is a '${typeof(this.responseText)}'`);
                    }

                };

                // Get the CMS
                xhttp.open("GET", "./queries/queries.txt", true);
                xhttp.send();

                // Log the cms
                // console.dir(cms, {depth: null});
            });

        </script>
    </body>

</html>